<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RippleVMS Knowledge Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#3b82f6',
                primaryTextColor: '#f1f5f9',
                primaryBorderColor: '#475569',
                lineColor: '#64748b',
                secondaryColor: '#7c3aed',
                tertiaryColor: '#1e293b',
                background: '#0f172a',
                mainBkg: '#1e293b',
                nodeBorder: '#475569',
                clusterBkg: '#1e293b',
                clusterBorder: '#475569',
                titleColor: '#f1f5f9',
                edgeLabelBackground: '#1e293b'
            },
            flowchart: { curve: 'basis', padding: 20 },
            er: { layoutDirection: 'TB' },
            sequence: { diagramMarginX: 50, diagramMarginY: 10, actorMargin: 50, width: 150, height: 65, boxMargin: 10, useMaxWidth: true }
        });
    </script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-purple: #a855f7;
            --accent-orange: #f97316;
            --accent-cyan: #06b6d4;
            --accent-red: #ef4444;
            --border-color: #475569;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 3rem; padding: 2rem; background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%); border-radius: 16px; border: 1px solid var(--border-color); }
        header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        header p { color: var(--text-secondary); font-size: 1.1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .stat-card { background: var(--bg-primary); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border-color); }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: var(--accent-cyan); }
        .stat-label { font-size: 0.85rem; color: var(--text-secondary); }
        .nav-tabs { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 2rem; padding: 1rem; background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color); }
        .nav-tab { padding: 0.75rem 1.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
        .nav-tab:hover { background: var(--bg-primary); color: var(--text-primary); }
        .nav-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border-color); }
        .card h2 { color: var(--accent-blue); margin-bottom: 1rem; font-size: 1.5rem; }
        .mermaid { background: var(--bg-primary); border-radius: 8px; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
        .perm-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 1rem; }
        .perm-table th, .perm-table td { padding: 0.75rem; border: 1px solid var(--border-color); text-align: center; }
        .perm-table th { background: var(--bg-tertiary); }
        .perm-table td:first-child { text-align: left; font-weight: 500; }
        .perm-yes { color: var(--accent-green); font-weight: bold; }
        .perm-no { color: var(--text-secondary); }
        .api-route { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 0.75rem; background: var(--bg-primary); border-radius: 6px; margin-bottom: 0.5rem; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; }
        .api-method { padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600; min-width: 50px; text-align: center; }
        .api-method.get { background: var(--accent-green); color: white; }
        .api-method.post { background: var(--accent-blue); color: white; }
        .api-method.put { background: var(--accent-orange); color: white; }
        .api-method.delete { background: var(--accent-red); color: white; }
        .api-path { color: var(--text-primary); }
        .api-desc { color: var(--text-secondary); margin-left: auto; font-family: inherit; }
        .api-group { margin-bottom: 1.5rem; }
        .api-group-title { color: var(--accent-blue); font-size: 1rem; margin-bottom: 0.75rem; padding-left: 0.5rem; border-left: 3px solid var(--accent-blue); }
        .tech-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .tech-card { background: var(--bg-primary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color); }
        .tech-name { font-weight: 600; color: var(--text-primary); }
        .tech-desc { font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .role-admin { color: var(--accent-purple); }
        .role-coord { color: var(--accent-blue); }
        .role-dispatch { color: var(--accent-orange); }
        .role-volunteer { color: var(--accent-green); }
        footer { text-align: center; padding: 2rem; color: var(--text-secondary); font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RippleVMS Knowledge Graph</h1>
            <p>Interactive visualization of system architecture and component relationships</p>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value">180+</div><div class="stat-label">TypeScript Files</div></div>
                <div class="stat-card"><div class="stat-value">38</div><div class="stat-label">Database Models</div></div>
                <div class="stat-card"><div class="stat-value">125+</div><div class="stat-label">API Routes</div></div>
                <div class="stat-card"><div class="stat-value">78</div><div class="stat-label">Pages</div></div>
                <div class="stat-card"><div class="stat-value">5</div><div class="stat-label">User Roles</div></div>
            </div>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" data-section="overview">Overview</div>
            <div class="nav-tab" data-section="database">Database</div>
            <div class="nav-tab" data-section="api">API Routes</div>
            <div class="nav-tab" data-section="workflows">Workflows</div>
            <div class="nav-tab" data-section="permissions">Permissions</div>
        </nav>

        <!-- Overview Section -->
        <section id="overview" class="section active">
            <div class="card">
                <h2>System Architecture</h2>
                <pre class="mermaid">
flowchart TB
    subgraph Client["Client Layer"]
        Dashboard
        Coverage["Coverage Grid"]
        Schedule
        Shifts
        Sightings
        Volunteers
        Coordinator
        Admin
        TrainingCenter["Training Center"]
        Resources["Resources (Map, Docs)"]
        Settings
        Developer["Developer Console"]
    end
    subgraph Components["Component Layer"]
        Layout["Layout Components"]
        Maps["Map Components"]
        ScheduleComp["Schedule Components"]
        Onboarding["Onboarding Components"]
    end
    subgraph API["API Layer"]
        AuthAPI["/api/auth"]
        ShiftsAPI["/api/shifts"]
        TrainingsAPI["/api/trainings"]
        SightingsAPI["/api/sightings"]
        VolunteersAPI["/api/volunteers"]
        ScheduleAPI["/api/schedule"]
        CoverageAPI["/api/coverage"]
        TrainingCenterAPI["/api/training-center"]
        AdminAPI["/api/admin"]
        DeveloperAPI["/api/developer"]
        ProfileAPI["/api/profile"]
    end
    subgraph Services["Service Layer"]
        DB["lib/db.ts"]
        User["lib/user.ts"]
        Auth["lib/auth.ts"]
        Email["lib/email.ts"]
        S3Lib["lib/s3.ts"]
        Features["lib/features.ts"]
    end
    subgraph External["External Services"]
        Neon[("Neon PostgreSQL")]
        SES["AWS SES"]
        S3["Amazon S3"]
        GMaps["Google Maps"]
        NextAuth["NextAuth.js"]
    end
    Client --> Components
    Components --> API
    API --> Services
    Services --> External
                </pre>
            </div>
            <div class="card">
                <h2>Tech Stack</h2>
                <div class="tech-grid">
                    <div class="tech-card"><div class="tech-name">Next.js 16</div><div class="tech-desc">App Router, Server Components</div></div>
                    <div class="tech-card"><div class="tech-name">Prisma ORM</div><div class="tech-desc">Database access with Neon adapter</div></div>
                    <div class="tech-card"><div class="tech-name">Neon PostgreSQL</div><div class="tech-desc">Serverless database</div></div>
                    <div class="tech-card"><div class="tech-name">TypeScript</div><div class="tech-desc">Type-safe JavaScript</div></div>
                    <div class="tech-card"><div class="tech-name">Tailwind CSS</div><div class="tech-desc">Utility-first styling</div></div>
                    <div class="tech-card"><div class="tech-name">Resend</div><div class="tech-desc">Email notifications</div></div>
                    <div class="tech-card"><div class="tech-name">Google Maps</div><div class="tech-desc">Zone boundaries & POIs</div></div>
                    <div class="tech-card"><div class="tech-name">Vercel</div><div class="tech-desc">Hosting & deployment</div></div>
                </div>
            </div>
        </section>

        <!-- Database Section -->
        <section id="database" class="section">
            <div class="card">
                <h2>Core User & Organization</h2>
                <pre class="mermaid">
erDiagram
    User ||--o{ UserZone : has
    User ||--o{ UserQualification : has
    Zone ||--o{ UserZone : contains
    Zone ||--o{ PointOfInterest : has
    QualifiedRole ||--o{ UserQualification : grants
    POICategory ||--o{ PointOfInterest : categorizes
    User {
        string id PK
        string email UK
        string name
        enum role
        string phone
        boolean isActive
    }
    Zone {
        string id PK
        string name
        string code UK
        string color
        json boundaries
    }
    QualifiedRole {
        string id PK
        string name
        string slug UK
        string color
        boolean countsTowardMinimum
    }
                </pre>
            </div>
            <div class="card">
                <h2>Shift Management</h2>
                <pre class="mermaid">
erDiagram
    ShiftTypeConfig ||--o{ Shift : configures
    Zone ||--o{ Shift : hosts
    Shift ||--o{ ShiftVolunteer : has
    User ||--o{ ShiftVolunteer : participates
    ShiftTypeConfig {
        string id PK
        string name
        string slug UK
        string color
        int minVolunteers
        int maxVolunteers
    }
    Shift {
        string id PK
        string title
        datetime date
        datetime startTime
        datetime endTime
        enum status
    }
    ShiftVolunteer {
        string id PK
        string oderId FK
        string shiftId FK
        enum status
        boolean isZoneLead
    }
                </pre>
            </div>
            <div class="card">
                <h2>Training System</h2>
                <pre class="mermaid">
erDiagram
    TrainingType ||--o{ TrainingSession : creates
    TrainingSession ||--o{ TrainingSessionAttendee : has
    User ||--o{ TrainingSessionAttendee : attends
    TrainingType {
        string id PK
        string name
        int duration
        int capacity
    }
    TrainingSession {
        string id PK
        datetime date
        string location
        enum status
    }
    TrainingSessionAttendee {
        string id PK
        enum status
        datetime completedAt
    }
                </pre>
            </div>
            <div class="card">
                <h2>Incident Reporting</h2>
                <pre class="mermaid">
erDiagram
    IceSighting ||--o{ SightingMedia : has
    User ||--o{ IceSighting : manages
    IceSighting {
        string id PK
        string size
        string activity
        string location
        float latitude
        float longitude
        enum status
        enum disposition
        string assignedToId FK
        string notes
    }
    SightingMedia {
        string id PK
        string url
        enum type
    }
                </pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Status</div><div class="tech-desc">NEW â†’ REVIEWING â†’ DISPATCHED â†’ CLOSED</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-green);"><div class="tech-name">Disposition</div><div class="tech-desc">CONFIRMED | UNVERIFIED | FALSE_ALARM</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Training Center (Self-Paced)</h2>
                <pre class="mermaid">
erDiagram
    TrainingModule ||--o{ ModuleSection : contains
    TrainingModule ||--o{ ModuleEnrollment : has
    ModuleSection ||--o| ModuleQuiz : has
    ModuleQuiz ||--o{ QuizQuestion : contains
    QuizQuestion ||--o{ QuizOption : has
    ModuleEnrollment ||--o{ SectionProgress : tracks
    ModuleEnrollment ||--o{ QuizAttempt : has
    TrainingModule {
        string id PK
        string title
        string description
        enum status
        int estimatedMinutes
        string qualifiedRoleId FK
    }
    ModuleSection {
        string id PK
        enum type
        string title
        string content
        int sortOrder
    }
    ModuleQuiz {
        string id PK
        int passingScore
        int maxAttempts
        boolean shuffleQuestions
    }
    ModuleEnrollment {
        string id PK
        string oderId FK
        enum status
        datetime completedAt
    }
                </pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-cyan);"><div class="tech-name">Section Types</div><div class="tech-desc">VIDEO | TEXT | QUIZ | RESOURCE | ATTESTATION</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-purple);"><div class="tech-name">Enrollment Status</div><div class="tech-desc">NOT_STARTED â†’ IN_PROGRESS â†’ COMPLETED</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Coverage Grid (2-Hour Slots)</h2>
                <pre class="mermaid">
erDiagram
    Zone ||--o{ CoverageConfig : has
    CoverageConfig ||--o{ CoverageSignup : schedules
    User ||--o{ CoverageSignup : signs_up
    QualifiedRole ||--o{ CoverageSignup : requires
    Zone ||--o{ CoverageOverride : has
    CoverageConfig {
        string id PK
        string zoneId FK
        enum dayOfWeek
        int startHour
        int endHour
        int minVolunteers
    }
    CoverageSignup {
        string id PK
        string userId FK
        string qualifiedRoleId FK
        datetime date
        int startHour
        int endHour
    }
    CoverageOverride {
        string id PK
        datetime date
        enum type
        string notes
    }
                </pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-cyan);"><div class="tech-name">Time Blocks</div><div class="tech-desc">Fixed 2-hour slots: 6am-8am, 8am-10am, etc.</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Override Types</div><div class="tech-desc">CLOSURE | ADJUST_REQUIREMENTS</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Multi-Tenant Organization</h2>
                <pre class="mermaid">
erDiagram
    Organization ||--o{ OrganizationMember : has
    Organization ||--|| OrganizationSettings : configures
    User ||--o{ OrganizationMember : belongs_to
    Organization ||--o{ Zone : owns
    Organization ||--o{ Shift : owns
    Organization {
        string id PK
        string name
        string slug UK
        string logo
        boolean isActive
    }
    OrganizationMember {
        string id PK
        string userId FK
        string orgId FK
        enum role
        enum status
        json intakeAnswers
    }
    OrganizationSettings {
        string id PK
        string orgId FK
        string emailFromName
        enum dispatcherMode
        enum volunteerMode
        boolean autoConfirmRsvp
    }
                </pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-blue);"><div class="tech-name">Multi-Org</div><div class="tech-desc">Users can belong to multiple organizations</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-purple);"><div class="tech-name">Subdomain Routing</div><div class="tech-desc">[org-slug].ripple-vms.com</div></div>
                </div>
            </div>
        </section>

        <!-- API Routes Section -->
        <section id="api" class="section">
            <div class="card">
                <h2>API Routes</h2>
                <div class="api-group">
                    <div class="api-group-title">Authentication</div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/auth/[...nextauth]</span><span class="api-desc">NextAuth handlers</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/auth/session</span><span class="api-desc">Get current session</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/auth/forgot-password</span><span class="api-desc">Request password reset</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/auth/reset-password</span><span class="api-desc">Confirm password reset</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Shifts</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/shifts</span><span class="api-desc">List shifts</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/shifts</span><span class="api-desc">Create shift</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/shifts/[id]</span><span class="api-desc">Get shift details</span></div>
                    <div class="api-route"><span class="api-method put">PUT</span><span class="api-path">/api/shifts/[id]</span><span class="api-desc">Update shift</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/shifts/[id]/rsvp</span><span class="api-desc">RSVP to shift</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/shifts/bulk-edit</span><span class="api-desc">Bulk edit shifts</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/shifts/cancel</span><span class="api-desc">Cancel shift</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Trainings</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/trainings</span><span class="api-desc">List training sessions</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/trainings</span><span class="api-desc">Create training</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/trainings/[id]/rsvp</span><span class="api-desc">RSVP to training</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Volunteers</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/volunteers</span><span class="api-desc">List volunteers</span></div>
                    <div class="api-route"><span class="api-method put">PUT</span><span class="api-path">/api/volunteers/[id]</span><span class="api-desc">Update volunteer</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Sightings (Dispatcher)</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/sightings</span><span class="api-desc">List ICE sightings</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/sightings</span><span class="api-desc">Create sighting (auto-assigns)</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/sightings/[id]</span><span class="api-desc">Get sighting details</span></div>
                    <div class="api-route"><span class="api-method put">PUT</span><span class="api-path">/api/sightings/[id]</span><span class="api-desc">Update status/disposition</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Schedule</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/schedule</span><span class="api-desc">Weekly schedule data with dispatchers, leads, backups</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/dispatcher-assignments</span><span class="api-desc">Create dispatcher assignment</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/regional-lead-assignments</span><span class="api-desc">Assign dispatch coordinator</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Coverage</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/coverage/week</span><span class="api-desc">Weekly coverage grid data</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/coverage/signup</span><span class="api-desc">Sign up for coverage slot</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/coverage/cancel</span><span class="api-desc">Cancel coverage signup</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/dashboard/coverage</span><span class="api-desc">Coverage summary stats</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Admin</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/zones</span><span class="api-desc">Zone management</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/shift-types</span><span class="api-desc">Shift type config</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/qualified-roles</span><span class="api-desc">Qualified roles</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/admin/email-blast</span><span class="api-desc">Send email blast</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/intake-questions</span><span class="api-desc">Intake question config</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/pois</span><span class="api-desc">Points of interest</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/poi-categories</span><span class="api-desc">POI categories</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/admin/settings</span><span class="api-desc">Organization settings</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Training Center</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/training-center/modules</span><span class="api-desc">List training modules</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/training-center/modules</span><span class="api-desc">Create module</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/training-center/modules/[id]</span><span class="api-desc">Get module details</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/training-center/modules/[id]/sections</span><span class="api-desc">Add section</span></div>
                    <div class="api-route"><span class="api-method post">POST</span><span class="api-path">/api/training-center/quiz/[quizId]/attempt</span><span class="api-desc">Submit quiz attempt</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/training-center/progress/[moduleId]</span><span class="api-desc">Get user progress</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/training-center/stats</span><span class="api-desc">Module statistics</span></div>
                </div>
                <div class="api-group">
                    <div class="api-group-title">Developer</div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/stats</span><span class="api-desc">System statistics</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/health</span><span class="api-desc">Health check</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/logs</span><span class="api-desc">System logs</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/audit</span><span class="api-desc">Audit trail</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/organizations</span><span class="api-desc">Organization management</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/global-settings</span><span class="api-desc">Global feature flags</span></div>
                    <div class="api-route"><span class="api-method get">GET</span><span class="api-path">/api/developer/default-intake-questions</span><span class="api-desc">Default question templates</span></div>
                </div>
            </div>
        </section>

        <!-- Workflows Section -->
        <section id="workflows" class="section">
            <div class="card">
                <h2>Authentication Flow</h2>
                <pre class="mermaid">
sequenceDiagram
    participant U as User
    participant L as Login Page
    participant NA as NextAuth
    participant DB as Database
    U->>L: Enter credentials
    L->>NA: Authenticate
    NA->>DB: Verify password
    DB-->>NA: User record
    NA-->>L: JWT Token
    L-->>U: Redirect to Dashboard
                </pre>
            </div>
            <div class="card">
                <h2>Shift Workflow</h2>
<pre class="mermaid">
graph TD
A["Coordinator Creates Shift"]
A --> B["Draft or Published"]
B --> C["Volunteers See Shift"]
C --> D["Volunteer RSVPs"]
D --> E["Pending / Confirmed / Declined"]
E --> F["Shift Day"]
F --> G["Check In"]
G --> H["Check Out"]
H --> I["COMPLETED"]
</pre>
            </div>
            <div class="card">
                <h2>Training & Qualification Flow</h2>
<pre class="mermaid">
graph TD
A["Admin Creates TrainingType"]
A --> B["Grants QualifiedRoles"]
C["Coordinator Schedules Session"]
C --> D["TrainingSession Created"]
D --> E["Email Invites Sent"]
D --> F["Volunteers RSVP"]
F --> G["Attendance Tracked"]
G --> H["Completed Status"]
H --> I["UserQualification Created"]
I --> J["Role Granted to User"]
</pre>
            </div>
            <div class="card">
                <h2>ICE Sighting Dispatcher Workflow</h2>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">VMS complements Signal-based coordination for tracking and disposition</p>
<pre class="mermaid">
graph TD
A["ðŸ“± Signal: Report in BROADCAST"]
A --> B["ðŸ‘ Dispatcher Claims Report"]
B --> C["ðŸ–¥ï¸ VMS: New Sighting Entry"]
C --> D["Auto-assigned REVIEWING"]
D --> E{"Can Resolve Remotely?"}
E -->|YES| F["Set Disposition"]
E -->|NO| G["Mark DISPATCHED"]
G --> H["ðŸ“± Signal: Dispatch Request"]
H --> I["Field Team Verifies"]
I --> J["ðŸ“± Signal: Field Report"]
J --> F
F --> K["âœ… CONFIRMED"]
F --> L["â“ UNVERIFIED"]
F --> M["âŒ FALSE_ALARM"]
K --> N["Auto-CLOSED"]
L --> N
M --> N
</pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-cyan);"><div class="tech-name">Signal Integration</div><div class="tech-desc">VMS provides templates for Signal coordination</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Auto-Assignment</div><div class="tech-desc">Creating sighting auto-assigns to dispatcher</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-green);"><div class="tech-name">Auto-Close</div><div class="tech-desc">Setting disposition auto-closes sighting</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Dispatcher Scheduling Modes</h2>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">Three modes for varying activity levels - configured in Admin Settings</p>
<pre class="mermaid">
graph LR
    subgraph REGIONAL["ðŸŸ¢ REGIONAL (Low Activity)"]
        R1["One dispatcher"]
        R2["All counties"]
        R3["Per time block"]
        R1 --> R2 --> R3
    end
    subgraph COUNTY["ðŸŸ¡ COUNTY (Medium Activity)"]
        C1["One dispatcher"]
        C2["Per county"]
        C3["Per day"]
        C1 --> C2 --> C3
    end
    subgraph ZONE["ðŸ”´ ZONE (High Activity)"]
        Z1["Dispatcher shown"]
        Z2["Per cell"]
        Z3["With zone assignments"]
        Z1 --> Z2 --> Z3
    end
</pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-green);"><div class="tech-name">Regional Mode</div><div class="tech-desc">Dedicated dispatcher row between Dispatch Coordinator and counties</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">County Mode</div><div class="tech-desc">Dispatcher row under each county header</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-red);"><div class="tech-name">Zone Mode</div><div class="tech-desc">Dispatcher inline with zone assignments (default)</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Backup Dispatchers</h2>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">Region-wide backup dispatchers available to support any county</p>
<pre class="mermaid">
graph TD
    subgraph Schedule["Schedule View"]
        DC["Dispatch Coordinator"]
        BD["ðŸ”„ Backup Dispatchers"]
        CD["County Dispatchers"]
        ZL["Zone Leads"]
        DC --> BD
        BD --> CD
        CD --> ZL
    end
    subgraph BackupFeatures["Backup Dispatcher Features"]
        B1["Region-wide availability"]
        B2["Assigned per time block"]
        B3["Support any county"]
        B4["Orange highlighting"]
    end
    BD --- BackupFeatures
</pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Region-Wide</div><div class="tech-desc">Not tied to specific county - can support any area</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Time Block Based</div><div class="tech-desc">Assigned to specific time blocks (6am-10am, 10am-2pm, 2pm-6pm)</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name">Visual Display</div><div class="tech-desc">Orange "Backup Disp." row in schedule view</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Training Center Module Workflow</h2>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">Self-paced learning with progress tracking and qualification grants</p>
<pre class="mermaid">
graph TD
A["Admin Creates Module"]
A --> B["Add Sections"]
B --> C["VIDEO / TEXT / QUIZ / RESOURCE / ATTESTATION"]
C --> D["Configure Quiz"]
D --> E["Set Passing Score & Attempts"]
E --> F["Link to Qualified Role"]
F --> G["Publish Module"]
G --> H["Volunteer Starts Module"]
H --> I["Complete Each Section"]
I --> J{"All Sections Complete?"}
J -->|No| I
J -->|Yes| K["Module COMPLETED"]
K --> L["Auto-grant Qualified Role"]
L --> M["Volunteer Eligible for Shifts"]
</pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-cyan);"><div class="tech-name">Progress Tracking</div><div class="tech-desc">Video watch %, quiz scores, section completion</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-green);"><div class="tech-name">Auto-Qualification</div><div class="tech-desc">Completing module grants linked QualifiedRole</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Coverage Grid Signup Workflow</h2>
                <p style="margin-bottom: 1rem; color: var(--text-secondary);">2-hour time slot scheduling for granular coverage</p>
<pre class="mermaid">
graph TD
A["Volunteer Views Coverage Grid"]
A --> B["Select Zone & Date"]
B --> C["View Available Time Slots"]
C --> D{"Has Required Qualification?"}
D -->|No| E["Cannot Sign Up"]
D -->|Yes| F["Click Time Slot"]
F --> G["Select Role"]
G --> H["Confirm Signup"]
H --> I["CoverageSignup Created"]
I --> J["Appears on Schedule"]
subgraph Override["Admin Override Options"]
    K["Set CLOSURE"]
    L["ADJUST_REQUIREMENTS"]
end
</pre>
                <div class="tech-grid" style="margin-top: 1rem;">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-cyan);"><div class="tech-name">Fixed Slots</div><div class="tech-desc">6am-8am, 8am-10am, 10am-12pm, etc.</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-purple);"><div class="tech-name">Role-Based</div><div class="tech-desc">Verifier, Zone Lead, Dispatcher, Coordinator</div></div>
                </div>
            </div>
        </section>

        <!-- Permissions Section -->
        <section id="permissions" class="section">
            <div class="card">
                <h2>User Roles</h2>
                <div class="tech-grid">
                    <div class="tech-card" style="border-left: 4px solid var(--accent-red);"><div class="tech-name" style="color: var(--accent-red);">DEVELOPER</div><div class="tech-desc">Platform-wide admin, multi-org management, system monitoring</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-purple);"><div class="tech-name role-admin">ADMINISTRATOR</div><div class="tech-desc">Full org system access, user management, settings</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-blue);"><div class="tech-name role-coord">COORDINATOR</div><div class="tech-desc">Manage shifts, volunteers, trainings</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-orange);"><div class="tech-name role-dispatch">DISPATCHER</div><div class="tech-desc">Full coordinator access plus real-time coordination</div></div>
                    <div class="tech-card" style="border-left: 4px solid var(--accent-green);"><div class="tech-name role-volunteer">VOLUNTEER</div><div class="tech-desc">View/RSVP shifts, update profile</div></div>
                </div>
            </div>
            <div class="card">
                <h2>Permission Matrix</h2>
                <table class="perm-table">
                    <thead>
                        <tr><th>Feature / Action</th><th class="role-volunteer">Volunteer</th><th class="role-dispatch">Dispatcher</th><th class="role-coord">Coordinator</th><th class="role-admin">Admin</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>View Dashboard</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>View Shifts</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>RSVP to Shifts</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Create Shifts</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Edit Shifts</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Bulk Edit Shifts</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>View Trainings</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Create Trainings</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>View Volunteer Roster</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Edit Volunteers</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>View Dispatch Reports</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Manage Dispatch Reports</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Edit Qualifications</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Zone Management</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Email Blasts</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>POI Categories</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td style="padding-left: 1.5rem; font-style: italic; color: var(--text-secondary);" colspan="5">Admin Settings</td></tr>
                        <tr><td>Feature Flags</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Shift Types</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Training Types</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Qualified Roles</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td>Counties</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-yes">&#10003;</td></tr>
                        <tr><td style="padding-left: 1.5rem; font-style: italic; color: var(--text-secondary);" colspan="5">Developer Only</td></tr>
                        <tr><td>Developer Console</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td><td class="perm-no">-</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="card">
                <h2>Qualified Roles (Coverage Positions)</h2>
                <div class="tech-grid">
                    <div class="tech-card"><div class="tech-name" style="color: #3b82f6;">ðŸ‘· Zone Lead</div><div class="tech-desc">Leads field operations in a specific zone</div></div>
                    <div class="tech-card"><div class="tech-name" style="color: #f97316;">ðŸŽ§ Dispatcher</div><div class="tech-desc">Coordinates communications for a zone</div></div>
                    <div class="tech-card"><div class="tech-name" style="color: #22c55e;">ðŸ“‹ Verifier</div><div class="tech-desc">Field volunteers who verify sightings</div></div>
                    <div class="tech-card"><div class="tech-name" style="color: #a855f7;">ðŸª„ Coordinator</div><div class="tech-desc">Regional coordinators covering all zones</div></div>
                </div>
                <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                    <strong>Scheduling Modes:</strong> SIMPLE mode shows only leaders (Zone Leads, Dispatchers, Coordinators). FULL mode includes Verifiers.
                </p>
            </div>
        </section>

        <footer>
            <p>RippleVMS Knowledge Graph | Updated January 3, 2026</p>
            <p style="font-size: 0.85rem; margin-top: 0.5rem;">Next.js 16 | Prisma ORM | PostgreSQL (Neon) | TypeScript | Tailwind CSS | Resend</p>
        </footer>
    </div>

    <script>
        const tabs = document.querySelectorAll('.nav-tab');
        const sections = document.querySelectorAll('.section');

        const renderSection = (section) => {
            if (!section) return;
            const diagrams = section.querySelectorAll('.mermaid:not([data-processed="true"])');
            if (diagrams.length) {
                mermaid.init(undefined, diagrams);
            }
        };

        renderSection(document.querySelector('.section.active'));

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                sections.forEach(s => s.classList.remove('active'));
                const targetSection = document.getElementById(tab.dataset.section);
                targetSection.classList.add('active');
                renderSection(targetSection);
            });
        });
    </script>
</body>
</html>
